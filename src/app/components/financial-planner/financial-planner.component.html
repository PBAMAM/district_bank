<app-client-layout>
  <div class="financial-planner">
    <!-- Header Section -->
    <div class="transactions-header" *ngIf="!isLoading" [@fadeInUp]>
      <div class="header-content">
        <div class="header-icon">üìä</div>
        <div class="header-text">
          <h1>Transaction History</h1>
          <p class="header-subtitle">View and analyze all your financial transactions</p>
        </div>
      </div>
    </div>

    <!-- Summary Cards -->
    <div class="summary-cards" *ngIf="!isLoading && recentTransactions.length > 0" [@fadeInUp]>
      <div class="summary-card total" [@scaleIn]>
        <div class="card-icon">üìã</div>
        <div class="card-content">
          <div class="card-label">Total Transactions</div>
          <div class="card-value">{{ recentTransactions.length }}</div>
        </div>
      </div>
      
      <div class="summary-card income" [@scaleIn]>
        <div class="card-icon">üí∞</div>
        <div class="card-content">
          <div class="card-label">Total Income</div>
          <div class="card-value positive">{{ formatCurrency(totalIncome) }}</div>
        </div>
      </div>
      
      <div class="summary-card expenditure" [@scaleIn]>
        <div class="card-icon">üí∏</div>
        <div class="card-content">
          <div class="card-label">Total Expenditure</div>
          <div class="card-value negative">{{ formatCurrency(totalExpenditure) }}</div>
        </div>
      </div>
      
      <div class="summary-card surplus" [@scaleIn]>
        <div class="card-icon">üìà</div>
        <div class="card-content">
          <div class="card-label">Net Surplus</div>
          <div class="card-value" [class]="totalSurplus >= 0 ? 'positive' : 'negative'">
            {{ formatCurrency(totalSurplus) }}
          </div>
        </div>
      </div>
    </div>

    <!-- Loading State -->
    <div *ngIf="isLoading" class="loading-state" [@fadeIn]>
      <div class="spinner-wrapper">
        <div class="spinner"></div>
        <div class="spinner-ring"></div>
      </div>
      <p>Loading your transaction data...</p>
    </div>

    <div class="planner-content" *ngIf="!isLoading">
      <!-- Recent Transactions - Highlighted Main Card -->
      <div class="recent-transactions-card" *ngIf="recentTransactions.length > 0" [@fadeInUp]>
        <div class="card-header-main">
          <div class="header-content">
            <h2>Recent Transactions</h2>
            <p class="card-subtitle-main">Your complete transaction history</p>
          </div>
          <div class="transaction-count-badge">
            <span class="count-number">{{ recentTransactions.length }}</span>
            <span class="count-label">Transactions</span>
          </div>
        </div>
        
        <div class="transactions-list">
          <div class="transaction-item" *ngFor="let transaction of recentTransactions; let i = index" [@slideInRight] [style.animation-delay.ms]="i * 50">
            <div class="transaction-icon" [class.positive]="transaction.amount > 0" [class.negative]="transaction.amount < 0">
              <span class="icon">{{ transaction.amount > 0 ? '‚Üë' : '‚Üì' }}</span>
            </div>
            <div class="transaction-details">
              <div class="transaction-description">{{ transaction.description || 'Transaction' }}</div>
              <div class="transaction-meta">
                <span class="transaction-date">{{ transaction.createdAt | date:'medium' }}</span>
                <span class="transaction-type" [class.transfer-out]="transaction.type === 'transfer' && transaction.amount < 0" [class.transfer-in]="transaction.type === 'transfer' && transaction.amount > 0">
                  {{ transaction.type === 'transfer' && transaction.amount < 0 ? 'TRANSFER OUT' : transaction.type === 'transfer' && transaction.amount > 0 ? 'TRANSFER IN' : (transaction.type || 'Transfer') | uppercase }}
                </span>
                <span class="transaction-status" [class.completed]="transaction.status === 'completed'">
                  {{ transaction.status || 'Completed' }}
                </span>
              </div>
            </div>
            <div class="transaction-amount-wrapper">
              <div class="transaction-amount" [class.positive]="transaction.amount > 0" [class.negative]="transaction.amount < 0">
                {{ transaction.amount > 0 ? '+' : '' }}{{ formatCurrency(transaction.amount) }}
              </div>
              <div class="transaction-currency">{{ transaction.currency || 'EUR' }}</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Empty State -->
      <div class="empty-transactions" *ngIf="recentTransactions.length === 0" [@fadeIn]>
        <div class="empty-icon">üìã</div>
        <h3>No Transactions Yet</h3>
        <p>Your transaction history will appear here once you make your first transfer.</p>
      </div>

      <!-- Secondary Cards Grid -->
      <div class="secondary-cards-grid" *ngIf="recentTransactions.length > 0">
        <!-- Income and Expenditure Card -->
        <div class="planner-card" [@scaleIn]>
          <div class="card-header">
            <h3>Income & Expenditure</h3>
            <span class="info-icon">‚ÑπÔ∏è</span>
          </div>
          <div class="card-subtitle">{{ (accounts[0] && accounts[0].accountType) || 'Main Account' }}</div>
          
          <div class="chart-container">
            <h4>Last 3 months</h4>
            <div class="chart-wrapper">
              <canvas baseChart
                [data]="incomeExpenditureData"
                [options]="chartOptions"
                type="bar">
              </canvas>
            </div>
            <div class="chart-legend">
              <div class="legend-item income">
                <span class="legend-color"></span>
                <span class="legend-text">{{ formatCurrency(totalIncome) }} Income</span>
              </div>
              <div class="legend-item expenditure">
                <span class="legend-color"></span>
                <span class="legend-text">- {{ formatCurrency(totalExpenditure) }} Expenditure</span>
              </div>
              <div class="legend-item surplus">
                <span class="legend-color"></span>
                <span class="legend-text">{{ formatCurrency(totalSurplus) }} Surplus</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Forecast Card -->
        <div class="planner-card" [@scaleIn]>
          <div class="card-header">
            <h3>Forecast</h3>
            <span class="info-icon">‚ÑπÔ∏è</span>
          </div>
          <div class="card-subtitle">{{ (accounts[0] && accounts[0].accountType) || 'Main Account' }}</div>
          
          <div class="chart-container">
            <h4>Expected balance by month-end</h4>
            <div class="chart-wrapper">
              <canvas baseChart
                [data]="forecastData"
                [options]="chartOptions"
                type="line">
              </canvas>
            </div>
            <div class="forecast-points">
              <div class="forecast-point">
                <span class="point-label">Today</span>
                <span class="point-value">{{ formatCurrency((accounts[0] && accounts[0].balance) || 0) }}</span>
              </div>
              <div class="forecast-point">
                <span class="point-label">6 months</span>
                <span class="point-value">{{ formatCurrency(forecastData.datasets[0].data[6]) }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</app-client-layout>
